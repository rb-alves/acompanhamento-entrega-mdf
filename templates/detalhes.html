<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes do Pedido</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-6">

  <div id="detalhes" class="max-w-3xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <h1 class="text-2xl font-bold mb-4 text-center">Detalhes do Pedido</h1>
    <div id="conteudo"></div>
  </div>

  <script>
    async function carregarDetalhes() {
      const params = new URLSearchParams(window.location.search);
      const cpf = params.get("cpf");
      const pedido = params.get("pedido");
      const loja = params.get("loja");

      const resposta = await fetch(`/api/pedidos?cpf=${cpf}`);
      const dados = await resposta.json();

      // procura o pedido específico
      const info = dados.find(p => p.pedido == pedido && p.loja == loja);

      if (!info) {
        document.getElementById('conteudo').innerHTML = "<p>Nenhum detalhe encontrado.</p>";
        return;
      }

      // monta a lista de itens do pedido
      let itensHTML = "";
      if (info.itens && info.itens.length > 0) {
        itensHTML = info.itens.map(i => `
          <li class="flex justify-between border-b py-1">
            <span>Item: ${i.item}</span>
            <span>Qtd: ${(i.quantidade / 1000).toFixed(0)} — 
              R$ ${(i.preco / 100).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</span>
          </li>
        `).join("");
      } else {
        itensHTML = "<li class='text-gray-500'>Nenhum item encontrado.</li>";
      }

      // renderiza os detalhes do pedido
      document.getElementById('conteudo').innerHTML = `
        <div class="space-y-2">
          <p><strong>Loja:</strong> ${info.loja}</p>
          <p><strong>Pedido:</strong> ${info.pedido}</p>
          <p><strong>Cliente:</strong> ${info.cliente}</p>
          <p><strong>Vendedor:</strong> ${info.vendedor ?? "—"}</p>
          <p><strong>Data:</strong> ${info.data}</p>
          <p><strong>Valor Total:</strong> R$ ${(info.valor / 100).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</p>
          <p><strong>Situação Atual:</strong> 
            <span class="px-2 py-1 rounded-full text-sm font-semibold
              ${info.situacao_pedido === 'Concluido' ? 'bg-green-100 text-green-700' :
                info.situacao_pedido === 'Em Transito' ? 'bg-yellow-100 text-yellow-700' :
                'bg-gray-100 text-gray-700'}">
              ${info.situacao_pedido}
            </span>
          </p>
        </div>

        <h3 class="font-semibold mt-6 mb-2 text-lg border-b pb-2">Itens do Pedido</h3>
        <ul class="list-none space-y-1">${itensHTML}</ul>

        <div class="text-center mt-6">
          <a href="/" class="text-blue-600 font-medium hover:underline">← Voltar</a>
        </div>
      `;
    }

    carregarDetalhes();
  </script>
</body>
</html>
